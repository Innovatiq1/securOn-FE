import { HttpClient } from '@angular/common/http';
import { Component } from '@angular/core';
import { MatCard } from '@angular/material/card';
import { ActivatedRoute } from '@angular/router';
import { MaterialModule } from 'src/app/material.module';
import { ScoreChipComponent } from "../../score-chip/score-chip.component";
import { CvssAttribute } from 'src/app/pipe/cvss-attribute.pipe';
import { BaseScore } from 'src/app/pipe/base-score.pipe';
import { CommonModule } from '@angular/common';
import { VulnerabilityDataService } from 'src/app/services/api/shared.service';

@Component({
  selector: 'app-cve-view',
  standalone: true,
  imports: [MaterialModule, ScoreChipComponent,CvssAttribute,BaseScore,CommonModule],
  templateUrl: './cve-view.component.html',
  styleUrl: './cve-view.component.scss'
})
export class CveViewComponent {
  cveId: number;
  data: any;
  constructor(private activeroute:ActivatedRoute,private http: HttpClient, public vulnerabilityDataService: VulnerabilityDataService,){
this.activeroute.queryParams.subscribe(params =>{
  this.cveId = params['cveId'];
})
  }

  ngOnInit() {
    this.postView();
  }
  postView() {
    this.vulnerabilityDataService.show();
    // const apiUrl = 'https://cve.innovsectraker.com:8000/getCveDetails';
    const apiUrl = 'http://localhost:8000/getCveDetails'

    this.http.post(apiUrl, { cveId: this.cveId }).subscribe(
      (response: any) => {
        this.data = response;
        this.vulnerabilityDataService.hide();
      },
      (error) => {
        console.error('API Error:', error);
      }
    );

  }

  _backToList(): void {
    window.history.back();
  }
}
